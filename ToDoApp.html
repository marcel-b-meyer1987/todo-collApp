<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToDo App</title>
    <!-- <link rel="stylesheet" href="styles.css"> -->
    <style>
        :root {
    --cyan-bluish-gray: #abb8c3;
    --black: #000000;
    --white: #ffffff;
    --vivid-red: #cf2e2e;
    --light-green-cyan: #7bdcb5;
 
    --weidler-blau: rgb(0,83,130);
    --weidler-orange: rgb(247,148,29);
    --weidler-weiss: rgb(255,255,255);

    --background: rgb(0,0,0);
    --primary-color: rgb(30,30,30);
    --secondary-color: rgb(0,83,130);
    --accent-color: rgb(247,148,29);
    --text-color: rgb(255,255,255);

}

*{
    margin: 0;
    padding: 0;
}

html {
    font-family: 'Roboto', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size: 16pt;
    color: var(--text-color);
}

body{
    min-height: 100vh;
    padding: 10px;
    background-color: var(--background);
    display: flex;
    flex-direction: column;
    align-items: center;
}

h1 {
    margin-top: 100px;
    margin-bottom: 20px;
    font-size: 3rem;
    font-weight: 800;
    text-transform: uppercase;
    text-align: center;
    color: var(--accent-color);
}

.wrapper {
    width: 700px;
    max-width: 100%;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

#todo-input {
    box-sizing: border-box;
    padding: 12px 20px;
    width: 100%;
    background:none;
    border: 2px solid var(--secondary-color);
    border-radius: 1000px;
    font: inherit;
    color: var(--text-color);
    caret-color: var(--accent-color);
	rows: 3;
}

#todo-input:focus {
    outline: none;
}

form {
    position: relative;
}

#add-button {
    position: absolute;
    top: 0;
    right: 0;

    background-color: var(--accent-color);
    height: 100%;
    padding: 0 30px;
    border: none;
    border-radius: 1000px;
    font: inherit;
    font-weight: 600;
    color: var(--background);
    cursor: pointer;
    text-transform: uppercase;
}

.todo {
    margin-bottom: 10px;
    padding: 0 16px;
    background-color: var(--primary-color);
    border-radius: 15px;
    display: flex;
    align-items: center;
}

.todo .todo-text {
    padding: 15px;
    padding-right: 0;
    flex-grow: 1;
    transition: 200ms ease;
}

.delete-button {
    padding: 3px;
    background: none;
    border: none;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
}

.delete-button svg {
    transition: 200ms ease;
}

.delete-button:hover svg {
    fill: var(--accent-color);
}

.edit-button {
    padding: 3px;
    background: none;
    border: none;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
}

.edit-button svg {
    transition: 200ms ease;
}

.edit-button:hover svg {
    stroke: var(--accent-color);
}

.assign-button {
    padding: 3px;
    background: none;
    border: none;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
	stroke: var(--secondary-color);
	
}

.assign-button svg {
    transition: 200ms ease;
}

.assign-button:hover svg {
    fill: var(--accent-color);
}

.custom-checkbox {
    border: 2px solid var(--accent-color);
    border-radius: 50%;
    min-height: 20px;
    min-width: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-shrink: 0;
    transition: 200ms ease;
    cursor: pointer;
}

input[type="checkbox"]:checked ~ .custom-checkbox {
    background-color: var(--accent-color);
}

input[type="checkbox"]:checked ~ .custom-checkbox svg {
    fill: var(--primary-color);
}

input[type="checkbox"]:checked ~ .todo-text {
    text-decoration: line-through;
    color: var(--secondary-color);
}

input[type="checkbox"] {
    display: none;
}

@media(max-width: 500px) {
    html {
        font-size: 12pt;
    }
    #add-button {
        position: unset;
        width: 100%;
        margin-top: 10px;
        padding: 15px;
        height: auto;
    }
    
    h1 {
        margin-top: 50px;
        font-size: 15vw;
    }
}
    </style>
	<link href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAc/8AAAAAAABaxwAAX9QA////AABl4AAAbPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAEEUAAAAACIkERQiIgACIkEREUIiIDM0FEQRQzMzMzNDM0EUMzNVVVVVVBRVVVVVVVVVQUVVZmZmZmZkFGZmZmZmZmZGZgAAAAAAAAAAEAAAAAAAAAGAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAQAA" rel="icon" type="image/x-icon">
</head>
<body>
    <h1>To Do App</h1>
    <div class="wrapper">
        <form>
            <input type="textarea" rows="3" placeholder="Neue Aufgabe hier eingeben" id="todo-input" autocomplete="off">
            <button id="add-button">add</button>
        </form>
        <ul id="todo-list">
            
        </ul>

    </div>
    <script async="async" defer>
	

const todoForm = document.querySelector('form');
const addButton = document.getElementById('add-button');
const todoInput = document.getElementById('todo-input');
const todoListUL = document.getElementById('todo-list');

const team = [];

let mode = "add";
let indexPointer;

let allTodos = getTodos();
updateTodoList();

todoForm.addEventListener('submit', function(e) {
    e.preventDefault();
	switch(mode) {
		case "add":
			addTodo();
			break;
		case "edit":
			
			//console.log(`Saving changes to this item: ${indexPointer}`);
			updateTodo(indexPointer);
			break;
	}	
    
})

function addTodo() {
    const todoText = todoInput.value.trim();
    if(todoText.length > 0) {
        const todoObject = {
            text: todoText,
            completed: false
        };
        allTodos.push(todoObject);
        updateTodoList();
        saveTodos();
        todoInput.value = "";
    }
}

function updateTodo(index) {
    const todoText = todoInput.value.trim();
    if(todoText.length > 0) {
        allTodos[index].text = todoText;
        updateTodoList();
        saveTodos();
        todoInput.value = "";
				
		
    }
	
	// change mode back from "edit" to "add"
	toggleMode("add");
}

function updateTodoList() {
    todoListUL.innerHTML = "";
    allTodos.forEach((todo, todoIndex) => {
        todoItem = createTodoItem(todo, todoIndex);
        todoListUL.append(todoItem);
    })
}

function createTodoItem(todo, todoIndex) {
    const todoLI = document.createElement("li");
    const todoID = "todo-" + todoIndex;
    const todoText = todo.text;

    todoLI.className = "todo";
    todoLI.innerHTML = `
                <input type="checkbox" id="${todoID}">
                <label for="${todoID}" class="custom-checkbox">
                    <svg fill="transparent" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#5f6368"><path d="M382-240 154-468l57-57 171 171 367-367 57 57-424 424Z"/></svg>
                </label>
                <label for="${todoID}" class="todo-text">
                    ${todoText}
                </label>
                <button class="delete-button">
                    <svg fill="var(--secondary-color)" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#5f6368"><path d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"/></svg>
                </button>
				<button class="edit-button" id="edit-${todoID}">
					<svg fill="none" height="20" stroke="var(--secondary-color)" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
				</button>
				<button class="assign-button" id="assign-${todoID}">
					<svg height="24px" stroke="var(--secondary-color)" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" viewBox="0 -960 960 960" width="24px" fill="var(--secondary-color)" xmlns="http://www.w3.org/2000/svg"><path d="M200-200v-560 179-19 400Zm80-240h221q2-22 10-42t20-38H280v80Zm0 160h157q17-20 39-32.5t46-20.5q-4-6-7-13t-5-14H280v80Zm0-320h400v-80H280v80Zm-80 480q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v258q-14-26-34-46t-46-33v-179H200v560h202q-1 6-1.5 12t-.5 12v56H200Zm480-200q-42 0-71-29t-29-71q0-42 29-71t71-29q42 0 71 29t29 71q0 42-29 71t-71 29ZM480-120v-56q0-24 12.5-44.5T528-250q36-15 74.5-22.5T680-280q39 0 77.5 7.5T832-250q23 9 35.5 29.5T880-176v56H480Z"/></svg>
				</button>

    `;

    const deleteButton = todoLI.querySelector(".delete-button");
    deleteButton.addEventListener("click", () => {
        deleteTodoItem(todoIndex);
    });
	
	const editButton = todoLI.querySelector("button.edit-button");
    editButton.addEventListener("click", (e) => {
		e.preventDefault;
		e.stopPropagation;
		console.log(e.target.closest("button"));
		let index = parseInt(e.target.closest("button").getAttribute("id").substr(10));
		console.log(`Index: ${index}`);
        editTodoItem(index);
    }, true);

	const assignButton = todoLI.querySelector(".assign-button");
    editButton.addEventListener("click", (e) => {
		e.preventDefault;
		e.stopPropagation;
		console.log(e.target.closest("button"));
		let index = parseInt(e.target.closest("button").getAttribute("id").substr(10));
		console.log(`Index: ${index}`);
        assignToTeamMember(index);
    }, true);

    const checkbox = todoLI.querySelector("input");
    checkbox.addEventListener("change", () => {
        allTodos[todoIndex].completed = checkbox.checked;
        saveTodos();
    });
    checkbox.checked = todo.completed;
    
    return todoLI;
}

function toggleMode(modePara) {

	switch(modePara) {
	
		case "edit":
			mode = modePara;
			addButton.innerText = "SAVE";
			break;
		
		case "add":
			mode = "add";
			addButton.innerText = "ADD";
			break;
			
		default:
			break;
	}

	console.log(`Mode: ${mode}`);
}

function deleteTodoItem(todoIndex) {
    allTodos = allTodos.filter((_, i) => i !== todoIndex);
    saveTodos();
    updateTodoList();
    /*alert(`ToDo No. ${todoIndex} was deleted.`);*/
}

function editTodoItem(todoIndex) {
    // add functionality to edit ToDo Item here:
	
	// change mode from "add" to "edit"
	toggleMode("edit");
	
	// get ToDo from Array + put Text into input + focus input
	const toDo = allTodos[todoIndex];
	todoInput.value = toDo.text;
	todoInput.focus();
	
	indexPointer = todoIndex;
	
	
    //alert(`Die Funktion f√ºr das Editieren von ToDo Nr. ${todoIndex} ist noch nicht implementiert.`);
}

function saveTodos() {
    const todoJSON = JSON.stringify(allTodos);
    localStorage.setItem("toDos", todoJSON);
}

function getTodos() {
    const todos = localStorage.getItem("toDos") || "[]";
    return JSON.parse(todos);
}


function addTeamMember() {
	
}

function assignToTeamMember(todoIndex) {
	alert("Item ${todoIndex} selected. Info: assignToTeamMember() function not implemented yet.");
}

function saveTeam() {
	
}

function getTeam() {
	
}

    </script>
</body>
</html>